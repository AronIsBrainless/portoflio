<script>
  // 1. Declare the variable OUTSIDE the function so it's "Global"
        // You can now access this anywhere in your script.
        let finalDownloadLink = ""; 

        async function getNewestDownload() {
            try {
                const response = await fetch('https://brainless.ddns.net/api/gdf_classic/var/current_data.xml');
                const xmlText = await response.text();
                
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "text/xml");

                // Get the class we want to find (e.g., "a")
                const newestTag = xmlDoc.querySelector("newest-ver");
                if (!newestTag) throw new Error("Could not find <newest-ver> in XML");
                
                const targetClass = newestTag.getAttribute("class");

                // Find the version matching that class
                const versions = xmlDoc.getElementsByTagName("version");
                
                for (let v of versions) {
                    if (v.getAttribute("class") === targetClass) {
                        // 2. Assign the value to our global variable
                        finalDownloadLink = v.getAttribute("download-link");
                        break; 
                    }
                }

                // 3. Update the HTML
                const statusElement = document.getElementById("status");
                if (statusElement && finalDownloadLink) {
                    statusElement.innerHTML = `<a href="${finalDownloadLink}">Download Link Found</a>`;
                    console.log("Global variable set to:", finalDownloadLink);
                } else {
                    statusElement.innerText = "Link not found for class: " + targetClass;
                }

            } catch (error) {
                console.error("Error:", error);
                // The check below prevents the "null" error if the div is missing
                const statusElement = document.getElementById("status");
                if (statusElement) statusElement.innerText = "Error loading XML.";
            }
        }

        // Run the logic
        getNewestDownload();
</script>